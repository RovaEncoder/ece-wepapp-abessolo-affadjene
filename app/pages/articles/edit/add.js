import { supabase } from "../../../utils/supabase";
import Layout from "../../../layout/layout";
import React from "react";
import Head from "next/head";
import ArticleForm from "../../../components/ArticleForm/ArticleForm";
import { useUser } from "@supabase/auth-helpers-react";

export default function Post() {
	const user = useUser();

	async function handleSubmit(event) {
		event.preventDefault();

		const title = event.target.title.value;
		const description = event.target.description.value;
		const content = event.target.content.value;
		const imageUrl = event.target.url.value;

		const body = {
			title,
			body: content,
			description,
			imageUrl,
			user_id: user.id,
		};
		const { error } = await supabase.from("articles").insert(body);

		if (error) {
			console.log("Oups ! ", error.message);
		} else {
			event.target.title.value = "";
			event.target.description.value = "";
			event.target.content.value = "";
			event.target.url.value = "";
		}
	}

	return (
		<>
			<Head>
				<title>Blog</title>
				<meta name="description" content="Generated by create next app" />
				<link rel="icon" href="/favicon.ico" />
			</Head>
			<Layout>
				<ArticleForm handleSubmit={handleSubmit} />
			</Layout>
		</>
	);
}
